<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="MySQL升级和降级, 自然语言处理 深度学习 算法码上来">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="1. MySQL升级和降级`
1.1 方式1.1.1 INPLACE  就地 
在一台服务器上，原版本升级到新版本。
风险较大。
==建议 ： 不管哪种方式升级，都应该先做备份。方便失败回退。==1.1.2 Mergeing 迁移   建议">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MySQL升级和降级 | 小明同学</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">小明同学</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">小明同学</div>
        <div class="logo-desc">
            
            计算机科学与技术 | 自然语言处理
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        MySQL升级和降级
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/数据库/" target="_blank">
                            <span class="chip bg-color">数据库</span>
                        </a>
                        
                        <a href="/tags/mysql/" target="_blank">
                            <span class="chip bg-color">mysql</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/mysql/" class="post-category" target="_blank">
                            mysql
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-24
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    小明
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    15 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="1-MySQL升级和降级"><a href="#1-MySQL升级和降级" class="headerlink" title="1. MySQL升级和降级"></a>1. MySQL升级和降级</h1><p>`</p>
<h2 id="1-1-方式"><a href="#1-1-方式" class="headerlink" title="1.1 方式"></a>1.1 方式</h2><pre class="line-numbers language-cs"><code class="language-cs">1.1.1 INPLACE  就地 
在一台服务器上，原版本升级到新版本。
风险较大。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="建议-：-不管哪种方式升级，都应该先做备份。方便失败回退。"><a href="#建议-：-不管哪种方式升级，都应该先做备份。方便失败回退。" class="headerlink" title="==建议 ： 不管哪种方式升级，都应该先做备份。方便失败回退。=="></a>==建议 ： 不管哪种方式升级，都应该先做备份。方便失败回退。==</h3><h2 id="1-1-2-Mergeing-迁移-建议"><a href="#1-1-2-Mergeing-迁移-建议" class="headerlink" title="1.1.2 Mergeing 迁移   建议"></a>1.1.2 Mergeing 迁移   建议</h2><pre class="line-numbers language-SPARQL"><code class="language-SPARQL">备份迁移 
主从迁移<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="1-2-升级注意事项"><a href="#1-2-升级注意事项" class="headerlink" title="1.2 升级注意事项"></a>1.2 升级注意事项</h3><pre class="line-numbers language-mssql"><code class="language-mssql">a. 支持GA版本之间升级
b. 5.6--> 5.7  ,先将5.6升级至最新版，再升级到5.7
c. 5.5 ---> 5.7 ,先将5.5 升级至最新，再5.5---> 5.6最新，再5.6--->5.7 最新
d. 回退方案要提前考虑好，最好升级前要备份(特别是往8.0版本升级)。
e. 降低停机时间（停业务的时间）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2-INPLACE-升级过程原理"><a href="#2-INPLACE-升级过程原理" class="headerlink" title="2.INPLACE 升级过程原理"></a>2.INPLACE 升级过程原理</h1><pre class="line-numbers language-cassandra"><code class="language-cassandra">0. 备份原数据库数据
a. 安装新版本软件
b. 关闭原数据库（挂维护页）
c. 使用新版本软件 “挂” 旧版本数据启动(--skip-grant-tables ,--skip-networking)
d. 升级 ： 只是升级系统表。升级时间和数据量无关的。
e. 正常重启数据库。
f. 验证各项功能是否正常。
g. 业务恢复<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>1.4 5.6.46 —-&gt; 5.7.28 Inplace 升级演练</p>
<pre class="line-numbers language-less"><code class="language-less">a<span class="token number">.</span> 安装 新版本软件 
b<span class="token number">.</span> 停原库 
# <span class="token number">1.</span> 快速关库功能关闭<span class="token punctuation">(</span>优雅关闭<span class="token punctuation">)</span>  
vim <span class="token operator">/</span>data<span class="token operator">/</span><span class="token number">3316</span><span class="token operator">/</span>my<span class="token number">.</span>cnf 
## 添加以下配置
innodb_fast_shutdown=<span class="token number">0</span> 
[root<span class="token variable">@db01</span> data]# systemctl stop mysqld<span class="token number">3316</span>
c<span class="token number">.</span> 使用高版本软件挂低版本数据启动<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-停止数据库"><a href="#1-停止数据库" class="headerlink" title="1-停止数据库"></a>1-停止数据库</h3><pre><code>[root@db01 data]# systemctl stop mysqld3316</code></pre><h2 id="2-使用高版本软件挂低版本数据启动"><a href="#2-使用高版本软件挂低版本数据启动" class="headerlink" title="2- 使用高版本软件挂低版本数据启动"></a>2- 使用高版本软件挂低版本数据启动</h2><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@db01 data]</span><span class="token comment" spellcheck="true"># vim /data/3316/my.cnf </span>
<span class="token namespace">[mysqld]</span>
user=mysql
basedir=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>app<span class="token operator">/</span>mysql
datadir=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>3316<span class="token operator">/</span><span class="token keyword">data</span>
socket=<span class="token operator">/</span>tmp<span class="token operator">/</span>mysql3316<span class="token punctuation">.</span>sock
port=3316
server_id=16
innodb_fast_shutdown=0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-启动"><a href="#3-启动" class="headerlink" title="3-启动"></a>3-启动</h2><pre class="line-numbers language-shell"><code class="language-shell">[root@db01 data]# /data/app/mysql/bin/mysqld_safe --defaults-file=/data/3316/my.cnf --skip-grant-tables --skip-networking &<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-升级"><a href="#4-升级" class="headerlink" title="4-升级"></a>4-升级</h2><p> 升级 （升级到8.0可以省略）</p>
<pre><code>d. 升级 （升级到8.0可以省略）
[root@db01 data]# /data/app/mysql/bin/mysql_upgrade -S /tmp/mysql3316.sock --force </code></pre><h2 id="5-重启数据库到正常状态"><a href="#5-重启数据库到正常状态" class="headerlink" title="5-重启数据库到正常状态"></a>5-重启数据库到正常状态</h2><pre class="line-numbers language-spreadsheet"><code class="language-spreadsheet">[root@db01 data]# mysqladmin -S /tmp/mysql3316.sock shutdown
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="修改启动脚本"><a href="#修改启动脚本" class="headerlink" title="修改启动脚本"></a>修改启动脚本</h3><pre class="line-numbers language-powershell"><code class="language-powershell">修改以下内容 


<span class="token namespace">[root@db01 data]</span><span class="token comment" spellcheck="true"># vim /etc/systemd/system/mysqld3316.service </span>

ExecStart=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>app<span class="token operator">/</span>mysql<span class="token operator">/</span>bin<span class="token operator">/</span>mysqld <span class="token operator">--</span>defaults<span class="token operator">-</span>file=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>3316<span class="token operator">/</span>my<span class="token punctuation">.</span>cnf
<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>
<span class="token namespace">[root@China ~]</span> <span class="token comment" spellcheck="true"># cat /etc/systemd/system/mysqld3316.service </span>
<span class="token namespace">[Unit]</span>
Description=MySQL Server
Documentation=man:mysqld<span class="token punctuation">(</span>8<span class="token punctuation">)</span>
Documentation=http:<span class="token operator">/</span><span class="token operator">/</span>dev<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>com<span class="token operator">/</span>doc<span class="token operator">/</span>refman<span class="token operator">/</span>en<span class="token operator">/</span><span class="token keyword">using</span><span class="token operator">-</span>systemd<span class="token punctuation">.</span>html
After=network<span class="token punctuation">.</span>target
After=syslog<span class="token punctuation">.</span>target
<span class="token namespace">[Install]</span>
WantedBy=multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target
<span class="token namespace">[Service]</span>
User=mysql
<span class="token function">Group</span>=mysql
ExecStart=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>app<span class="token operator">/</span>mysql80<span class="token operator">/</span>bin<span class="token operator">/</span>mysqld <span class="token operator">--</span>defaults<span class="token operator">-</span>file=<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>3316<span class="token operator">/</span>my<span class="token punctuation">.</span>cnf
LimitNOFILE = 5000
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-启动数据库"><a href="#6-启动数据库" class="headerlink" title="6-启动数据库"></a>6-启动数据库</h2><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@db01 data]</span><span class="token comment" spellcheck="true"># systemctl start mysqld3316 </span>

<span class="token comment" spellcheck="true"># 连接查看</span>
<span class="token namespace">[root@db01 data]</span><span class="token comment" spellcheck="true"># mysql -S /tmp/mysql3316.sock</span>
<span class="token namespace">[root@db01 ~]</span><span class="token comment" spellcheck="true"># mysqlsh root:123@10.0.0.51:3306 -e "util.checkForServerUpgrade()"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="3-SQL-应用基础"><a href="#3-SQL-应用基础" class="headerlink" title="3.-SQL 应用基础"></a>3.-SQL 应用基础</h1><h2 id="1、SQL介绍"><a href="#1、SQL介绍" class="headerlink" title="1、SQL介绍"></a>1、SQL介绍</h2><pre class="line-numbers language-css"><code class="language-css">结构化查询语言
<span class="token number">5.7</span> 以后符合SQL<span class="token number">92</span>严格模式
通过sql_mode参数来控制<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="2、常用SQL分类"><a href="#2、常用SQL分类" class="headerlink" title="2、常用SQL分类"></a>2、常用SQL分类</h2><pre class="line-numbers language-undefined"><code class="language-undefined">DDL：数据定义语言
DCL：数据控制语言
DML：数据操作语言
DQL：数据的查询语言<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3、数据类型、表属性、字符集"><a href="#3、数据类型、表属性、字符集" class="headerlink" title="3、数据类型、表属性、字符集"></a>3、数据类型、表属性、字符集</h2><h3 id="3-1-数据类型"><a href="#3-1-数据类型" class="headerlink" title="3.1  数据类型"></a>3.1  数据类型</h3><h3 id="3-1-1-作用"><a href="#3-1-1-作用" class="headerlink" title="3.1.1 作用"></a>3.1.1 作用</h3><pre><code>影响到了SQL语句的执行行为。为了让数据库在存、取能够满足生活的常识、科学的逻辑，让这些数据有意义。
例子： 
    现实生活中常识：
        日期： 1000-9999 年 1-12 月 1-31日 
    科学逻辑：         
        除法：除数不能为0</code></pre><h3 id="查看sql-mode"><a href="#查看sql-mode" class="headerlink" title="查看sql_mode"></a>查看sql_mode</h3><pre class="line-numbers language-powershell"><code class="language-powershell">mysql> <span class="token function">select</span> @@sql_mode<span class="token punctuation">;</span>
ONLY_FULL_GROUP_BY          :  针对<span class="token function">group</span> by 语句执行时的规范
STRICT_TRANS_TABLES         :  针对事务表启动严格模式
NO_ZERO_IN_DATE             ： 2010<span class="token operator">-</span>00<span class="token operator">-</span>10
NO_ZERO_DATE                ： 0000<span class="token operator">-</span>00<span class="token operator">-</span>00
ERROR_FOR_DIVISION_BY_ZERO  ： 除数不能为0
NO_AUTO_CREATE_USER         ： 是否自动创建用户
NO_ENGINE_SUBSTITUTION      :  建表是使用了一个不支持的存储引擎报错。    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="SQL-标准"><a href="#SQL-标准" class="headerlink" title="SQL 标准"></a>SQL 标准</h3><pre><code>SQL-89  \ SQL-92  \  SQL-99   \SQL03 .....</code></pre><pre class="line-numbers language-undefined"><code class="language-undefined">保证数据的准确性和标准性。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-数据库对象属性介绍"><a href="#4-数据库对象属性介绍" class="headerlink" title="4-数据库对象属性介绍"></a>4-数据库对象属性介绍</h2><pre><code>库
    库名
    库属性：字符集、校对规则

表 
    表名 
    列 ：
        列名
        列属性：数据类型、约束、其他属性
    行
    表属性：引擎、字符集、校对规则、其他。
</code></pre><h2 id="5-字符集"><a href="#5-字符集" class="headerlink" title="5-字符集"></a>5-字符集</h2><pre><code>MySQL 中的 “密码本”
2.2.2 种类
utf8    not  UTF-8  
utf8mb4 is   UTF-8（万国码）

特点 : 
1. utf8   , 最大支持3字节的字符。不支持emoji字符
2. utf8mb4, 最大支持4字节的字符。支持emoji字符。

8.0之前，默认字符集latin1,8.0之后是utf8mb4。
我们建议使用utf8mb4.

2.2.3 设置方法
默认字符集参数
建库
建表

2.3 校对规则（排序规则）  
2.3.1 作用 
影响到数据的排序方式。
    ASCII码
a    97
b    98
c    99
d    100

A    65
B    66
C    67
D    68

2.3.2 查看
mysql&gt; show collation;


2.4 列属性  </code></pre><h2 id="6-数据类型"><a href="#6-数据类型" class="headerlink" title="6-数据类型"></a>6-数据类型</h2><pre><code>#  作用 
尽可能保证数据是有意义的。
#  种类 
## 数字类型
整数：
    tinyint   1字节  =  8位 = 00000000 - 11111111  = 2^8个  = 0  - 255     , -127-128    
    int       4字节  =  32位                       = 2^32个 = 0  - 2^32-1  ,-2^31-2^31-1 ,10位数
    bigint    8字节                                           0  - 2^64-1  ,-2^63-2^63-1 ,20位数
浮点数：
    decimal(m,n)

## 字符串类型
char(N)    : 
    N字符个数，最大不超过255
    定长的字符串类型。
    例如： char(10) ,最多存10个字符,只要10个字符以内，都10个字符长度的存储空间。剩余用空格填充。
varchar(M) ：
    M字符个数，最大不超过65535
    变长的字符串类型。会额外占用1-2字节存储字符长度。255字符之内，额外1字节，255以上，额外2字节
    例如： varchar(10),最多存10个字符,按需分配存储空间。
    abc 3             =4
    asdasdadasd 1000  =1002

enum(&#39;bj&#39;,&#39;sh&#39;,&#39;tj&#39;,&#39;heibei&#39;,&#39;henan&#39;,.....)
district enum(&#39;bj&#39;,&#39;sh&#39;,&#39;tj&#39;,&#39;heibei&#39;,&#39;henan&#39;,.....)

## 时间类型 
datetime    8字节 
timestamp   4字节 

DATETIME 
范围为从 1000-01-01 00:00:00.000000 至 9999-12-31 23:59:59.999999。

TIMESTAMP 
1970-01-01 00:00:00.000000 至 2038-01-19 03:14:07.999999。
timestamp会受到时区的影响

## 二进制类型
## json 数据类型

</code></pre><h1 id="4-数据库降级"><a href="#4-数据库降级" class="headerlink" title="4-数据库降级"></a>4-数据库降级</h1><h2 id="1-官方解释"><a href="#1-官方解释" class="headerlink" title="1-官方解释"></a>1-官方解释</h2><pre><code>降级：
官方解释： 
https://dev.mysql.com/doc/refman/5.7/en/downgrade-paths.html
Downgrade from MySQL 5.7 to 5.6 is supported using the logical downgrade method.

https://dev.mysql.com/doc/refman/5.7/en/downgrade-binary-package.html#downgrade-procedure-inplace
In-place downgrade is supported for downgrades between GA releases within the same release series.

</code></pre><p>5.7.28 —》 5.7.10       inplace downgrade  ok</p>
<p>原环境：<br>    5.7.28 二进制版本 + /data/3306/data  </p>
<h2 id="2-安装-5-7-10-（低）-二进制版本"><a href="#2-安装-5-7-10-（低）-二进制版本" class="headerlink" title="2. 安装 5.7.10 （低） 二进制版本"></a>2. 安装 5.7.10 （低） 二进制版本</h2><pre><code>/data/app/mysql5710</code></pre><p>针对5728版本（高）进行处理工作</p>
<pre class="line-numbers language-shell"><code class="language-shell">https://dev.mysql.com/doc/refman/5.7/en/downgrading-to-previous-series.html

set sql_mode='STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' ;
set global sql_mode='STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' ;
select @@sql_mode;                              
ALTER TABLE mysql.proc MODIFY definer char(77) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL DEFAULT '';
ALTER TABLE mysql.event MODIFY definer char(77) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL DEFAULT '';
ALTER TABLE mysql.tables_priv MODIFY Grantor char(77) COLLATE utf8_bin NOT NULL DEFAULT '';
ALTER TABLE mysql.procs_priv MODIFY Grantor char(77) COLLATE utf8_bin NOT NULL DEFAULT '';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-优雅的关闭5-7-28（高）。"><a href="#3-优雅的关闭5-7-28（高）。" class="headerlink" title="3. 优雅的关闭5.7.28（高）。"></a>3. 优雅的关闭5.7.28（高）。</h2><pre class="line-numbers language-scss"><code class="language-scss">set global innodb_fast_shutdown=<span class="token number">0</span> <span class="token punctuation">;</span>
mysql --execute=<span class="token string">"SET GLOBAL innodb_fast_shutdown=0"</span>
mysqladmin  shutdown

[root@db<span class="token number">01</span> /data] # mysqladmin  -S /tmp/mysql<span class="token number">3308.</span>sock  shutdown
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-删除ib-logfile"><a href="#4-删除ib-logfile" class="headerlink" title="4. 删除ib_logfile*"></a>4. 删除ib_logfile*</h2><pre><code>防止冲突
[root@db01 mysql5710]# rm -rf /data/3306/data/ib_logfile*</code></pre><h2 id="5-替换配置文件、环境变量-（替换成低版本）"><a href="#5-替换配置文件、环境变量-（替换成低版本）" class="headerlink" title="5. 替换配置文件、环境变量 （替换成低版本）"></a>5. 替换配置文件、环境变量 （替换成低版本）</h2><pre class="line-numbers language-shell"><code class="language-shell">[root@db01 mysql5710]# vim /etc/my.cnf
[mysqld]
user=mysql
basedir=/data/app/mysql5710
#basedir=/data/app/mysql56
datadir=/data/3306/data
socket=/tmp/mysql.sock
[mysql]
socket=/tmp/mysql.sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[root@db01 mysql5710]# vim /etc/profile
export PATH=/data/app/mysql5710/bin:$PATH</code></pre><pre><code>[root@db01 mysql5710]# source /etc/profile

db01_5.7 [(none)]&gt;select version();
+-----------+
| version() |
+-----------+
| 5.7.10    |
+-----------+
1 row in set (0.00 sec)

db01_5.7 [(none)]&gt;

[root@db01 mysql5710]# mysql -V
mysql  Ver 14.14 Distrib 5.7.10, for linux-glibc2.5 (x86_64) using  EditLine wrapper</code></pre><h2 id="6-启动数据库-1"><a href="#6-启动数据库-1" class="headerlink" title="6. 启动数据库"></a>6. 启动数据库</h2><pre class="line-numbers language-scss"><code class="language-scss">[root@db<span class="token number">01</span> mysql<span class="token number">5710</span>]# /etc/init<span class="token number">.</span>d/mysqld start 
Starting MySQL<span class="token number">..</span> SUCCESS! 

   全路径启动
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="7-执行upgrade"><a href="#7-执行upgrade" class="headerlink" title="7. 执行upgrade"></a>7. 执行upgrade</h2><pre><code>[root@db01 /data] # /data/app/mysql5710/bin/mysql_upgrade   --force 
[root@db01 mysql5710]# mysql_upgrade --force </code></pre><pre class="line-numbers language-css"><code class="language-css">[root@db<span class="token number">01</span> /data] # /data/app/mysql<span class="token number">5710</span>/bin/mysql_upgrade   -S /tmp/mysql<span class="token number">3308.</span>sock   --force 
Checking server version<span class="token number">.</span>
Running queries to upgrade MySQL server<span class="token number">.</span>
Checking system database<span class="token number">.</span>
mysql<span class="token number">.</span>columns_priv                                 OK
mysql<span class="token number">.</span>db                                           OK
mysql<span class="token number">.</span>engine_cost                                  OK
mysql<span class="token number">.</span>event                                        OK
mysql<span class="token number">.</span>func                                         OK
mysql<span class="token number">.</span>general_log                                  OK
mysql<span class="token number">.</span>gtid_executed                                OK
mysql<span class="token number">.</span>help_category                                OK
mysql<span class="token number">.</span>help_keyword                                 OK
mysql<span class="token number">.</span>help_relation                                OK
mysql<span class="token number">.</span>help_topic                                   OK
mysql<span class="token number">.</span>innodb_index_stats                           OK
mysql<span class="token number">.</span>innodb_table_stats                           OK
mysql<span class="token number">.</span>ndb_binlog_index                             OK
mysql<span class="token number">.</span>plugin                                       OK
mysql<span class="token number">.</span>proc                                         OK
mysql<span class="token number">.</span>procs_priv                                   OK
mysql<span class="token number">.</span>proxies_priv                                 OK
mysql<span class="token number">.</span>server_cost                                  OK
mysql<span class="token number">.</span>servers                                      OK
mysql<span class="token number">.</span>slave_master_info                            OK
mysql<span class="token number">.</span>slave_relay_log_info                         OK
mysql<span class="token number">.</span>slave_worker_info                            OK
mysql<span class="token number">.</span>slow_log                                     OK
mysql<span class="token number">.</span>tables_priv                                  OK
mysql<span class="token number">.</span>time_zone                                    OK
mysql<span class="token number">.</span>time_zone_leap_second                        OK
mysql<span class="token number">.</span>time_zone_name                               OK
mysql<span class="token number">.</span>time_zone_transition                         OK
mysql<span class="token number">.</span>time_zone_transition_type                    OK
mysql<span class="token number">.</span>user                                         OK
The sys schema is already up to date <span class="token punctuation">(</span>version <span class="token number">1.5.2</span><span class="token punctuation">)</span><span class="token number">.</span>
Checking databases<span class="token number">.</span>
sys<span class="token number">.</span>sys_config                                     OK
Upgrade process completed successfully<span class="token number">.</span>
Checking if update is needed<span class="token number">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="5-数据库5-7-5-6降级"><a href="#5-数据库5-7-5-6降级" class="headerlink" title="5-数据库5.7-5.6降级"></a>5-数据库5.7-5.6降级</h1><h2 id="0-恢复5-7-28-环境"><a href="#0-恢复5-7-28-环境" class="headerlink" title="0. 恢复5.7.28 环境"></a>0. 恢复5.7.28 环境</h2><pre class="line-numbers language-css"><code class="language-css"><span class="token number">0.</span> 恢复<span class="token number">5.7.28</span> 环境 
[root@db<span class="token number">01</span> data]# pkill mysqld
[root@db<span class="token number">01</span> data]# rm -rf /data/<span class="token number">3306</span>/data/*
# 恢复配置文件
[root@db<span class="token number">01</span> data]# vim /etc/my<span class="token number">.</span>cnf
[mysqld]
user=mysql
basedir=/data/app/mysql
#basedir=/data/app/mysql<span class="token number">56</span>
datadir=/data/<span class="token number">3306</span>/data
socket=/tmp/mysql<span class="token number">.</span>sock
[mysql]
socket=/tmp/mysql<span class="token number">.</span>sock

# 恢复环境变量 
export PATH=/data/app/mysql/<span class="token property">bin</span><span class="token punctuation">:</span>$PATH
[root@db<span class="token number">01</span> data]# source /etc/profile

[root@db<span class="token number">01</span> data]# mysql -V
mysql  Ver <span class="token number">14.14</span> Distrib <span class="token number">5.7.28</span>, for linux-glibc<span class="token number">2.12</span> <span class="token punctuation">(</span>x<span class="token number">86</span>_<span class="token number">64</span><span class="token punctuation">)</span> using  EditLine wrapper
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="1-初始化数据"><a href="#1-初始化数据" class="headerlink" title="1-初始化数据"></a>1-初始化数据</h2><p>从新安装的软件</p>
<pre><code>mysqld --initialize-insecure --user=mysql --basedir=/data/app/mysql --datadir=/data/3306/data</code></pre><h2 id="2-启动数据库"><a href="#2-启动数据库" class="headerlink" title="2-启动数据库"></a>2-启动数据库</h2><pre class="line-numbers language-scss"><code class="language-scss">[root@db<span class="token number">01</span> data]# /etc/init<span class="token number">.</span>d/mysqld start
Starting MySQL<span class="token number">.</span>Logging to <span class="token string">'/data/3306/data/db01.err'</span><span class="token number">.</span>
 SUCCESS! 

 mysql> select <span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+-----------+
| <span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span> |
+-----------+
| <span class="token number">5.7.28</span>    |
+-----------+
<span class="token number">1</span> row in set <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-安装5-6-46二进制版本软件"><a href="#3-安装5-6-46二进制版本软件" class="headerlink" title="3-安装5.6.46二进制版本软件"></a>3-安装5.6.46二进制版本软件</h2><pre><code>/data/app/mysql56</code></pre><h2 id="4-处理5-7-28高版本数据"><a href="#4-处理5-7-28高版本数据" class="headerlink" title="4-处理5.7.28高版本数据"></a>4-处理5.7.28高版本数据</h2><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">set</span> sql_mode<span class="token operator">=</span><span class="token string">'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span> <span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> sql_mode<span class="token operator">=</span><span class="token string">'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span> <span class="token punctuation">;</span>
<span class="token keyword">select</span> @@sql_mode<span class="token punctuation">;</span>   
ALTER TABLE mysql<span class="token punctuation">.</span>proc MODIFY definer <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span> CHARACTER SET utf8 COLLATE utf8_bin NOT NULL DEFAULT <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span><span class="token keyword">event</span> MODIFY definer <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span> CHARACTER SET utf8 COLLATE utf8_bin NOT NULL DEFAULT <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>tables_priv MODIFY Grantor <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span> COLLATE utf8_bin NOT NULL DEFAULT <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>procs_priv MODIFY Grantor <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span> COLLATE utf8_bin NOT NULL DEFAULT <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>tables_priv MODIFY User <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT NULL <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>columns_priv MODIFY User <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT NULL <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>user MODIFY User <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT NULL <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>db MODIFY User <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT NULL <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>procs_priv MODIFY User <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> binary DEFAULT <span class="token string">''</span> NOT NULL<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>user ADD Password <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">)</span> character <span class="token keyword">set</span> latin1
collate latin1_bin NOT NULL <span class="token keyword">default</span> <span class="token string">''</span> AFTER user<span class="token punctuation">;</span>
UPDATE mysql<span class="token punctuation">.</span>user SET password <span class="token operator">=</span> authentication_string WHERE
<span class="token function">LENGTH</span><span class="token punctuation">(</span>authentication_string<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">41</span> AND plugin <span class="token operator">=</span> <span class="token string">'mysql_native_password'</span><span class="token punctuation">;</span>
UPDATE mysql<span class="token punctuation">.</span>user SET authentication_string <span class="token operator">=</span> <span class="token string">''</span> WHERE
<span class="token function">LENGTH</span><span class="token punctuation">(</span>authentication_string<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">41</span> AND plugin <span class="token operator">=</span> <span class="token string">'mysql_native_password'</span><span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>help_category ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>help_keyword ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>help_relation ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>help_topic ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>time_zone ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>time_zone_leap_second ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>time_zone_name ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>time_zone_transition  ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>time_zone_transition_type ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>plugin ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>servers ENGINE<span class="token operator">=</span><span class="token string">'MyISAM'</span> STATS_PERSISTENT<span class="token operator">=</span>DEFAULT<span class="token punctuation">;</span>
ALTER TABLE mysql<span class="token punctuation">.</span>user MODIFY plugin <span class="token function">CHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> COLLATE utf8_bin
DEFAULT <span class="token string">'mysql_native_password'</span><span class="token punctuation">;</span>
DROP DATABASE sys<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-逻辑备份5-7-28数据"><a href="#5-逻辑备份5-7-28数据" class="headerlink" title="5. 逻辑备份5.7.28数据"></a>5. 逻辑备份5.7.28数据</h2><pre class="line-numbers language-scss"><code class="language-scss">[root@db<span class="token number">01</span> /data] # mysqldump -S /tmp/mysql<span class="token number">3308.</span>sock   -A >/tmp/full<span class="token number">.</span>sql
[root@db<span class="token number">01</span> ~]# mysqldump -A >/tmp/full<span class="token number">.</span>sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="6-初始化一套5-6-46的空环境"><a href="#6-初始化一套5-6-46的空环境" class="headerlink" title="6. 初始化一套5.6.46的空环境"></a>6. 初始化一套5.6.46的空环境</h2><pre class="line-numbers language-shell"><code class="language-shell">[root@db01 ~]# vim /etc/profile
export PATH=/data/app/mysql56/bin:$PATH

[root@db01 ~]# source /etc/profile
[root@db01 ~]# mysql -V
mysql  Ver 14.14 Distrib 5.6.46, for linux-glibc2.12 (x86_64) using  EditLine wrapper

[root@db01 ~]# mv /etc/my.cnf /etc/my.cnf.bak
mv: overwrite ‘/etc/my.cnf.bak’? y

[root@db01 data]# rm -rf /data/3316/data/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-1-初始化-5-6"><a href="#6-1-初始化-5-6" class="headerlink" title="6.1-初始化 5.6"></a>6.1-初始化 5.6</h3><pre><code>[root@db01 data]# /data/app/mysql56/scripts/mysql_install_db  --user=mysql --basedir=/data/app/mysql56 --datadir=/data/3316/data
[root@db01 data]# systemctl start mysqld3316</code></pre><h2 id="7-恢复备份数据到5-6-46中"><a href="#7-恢复备份数据到5-6-46中" class="headerlink" title="7. 恢复备份数据到5.6.46中"></a>7. 恢复备份数据到5.6.46中</h2><pre class="line-numbers language-css"><code class="language-css">[root@db<span class="token number">01</span> data]# mysql -S /tmp/mysql<span class="token number">3316.</span>sock 
mysql> source /tmp/full<span class="token number">.</span>sql

把 /etc/my<span class="token number">.</span>cnf 的移动走<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="6-8-0的新功能"><a href="#6-8-0的新功能" class="headerlink" title="6-8.0的新功能"></a>6-8.0的新功能</h1><p>mysql-shell工具，8.0以后，可以调用这个命令，升级之前的预检查。</p>
<pre><code>[root@db01 ~]# mysqlsh root:123@10.0.0.51:3306 -e &quot;util.checkForServerUpgrade()&quot;</code></pre><h2 id="例如：-5-7-28-升级至-8-0-18-版本"><a href="#例如：-5-7-28-升级至-8-0-18-版本" class="headerlink" title="例如：  5.7.28 升级至 8.0.18 版本"></a>例如：  5.7.28 升级至 8.0.18 版本</h2><h3 id="1-下载-8-0-18-版本的-mysql-shell，并安装"><a href="#1-下载-8-0-18-版本的-mysql-shell，并安装" class="headerlink" title="1. 下载 8.0.18 版本的 mysql-shell，并安装"></a>1. 下载 8.0.18 版本的 mysql-shell，并安装</h3><pre><code>[root@db01 app]# yum install -y mysql-shell-8.0.18-1.el7.x86_64.rpm</code></pre><h3 id="2-恢复5728环境"><a href="#2-恢复5728环境" class="headerlink" title="2. 恢复5728环境"></a>2. 恢复5728环境</h3><pre class="line-numbers language-css"><code class="language-css">[root@db<span class="token number">01</span> data]# pkill mysqld
[root@db<span class="token number">01</span> data]# rm -rf /data/<span class="token number">3306</span>/data/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="3-恢复配置文件"><a href="#3-恢复配置文件" class="headerlink" title="3.恢复配置文件"></a>3.恢复配置文件</h3><pre class="line-numbers language-scss"><code class="language-scss">[root@db<span class="token number">01</span> data]# vim /etc/my<span class="token number">.</span>cnf
[mysqld]
user=mysql
basedir=/data/app/mysql
#basedir=/data/app/mysql<span class="token number">56</span>
datadir=/data/<span class="token number">3306</span>/data
socket=/tmp/mysql<span class="token number">.</span>sock
[mysql]
socket=/tmp/mysql<span class="token number">.</span>sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-恢复环境变量"><a href="#4-恢复环境变量" class="headerlink" title="4.恢复环境变量"></a>4.恢复环境变量</h3><pre class="line-numbers language-scss"><code class="language-scss">export PATH=/data/app/mysql/<span class="token property">bin</span><span class="token punctuation">:</span><span class="token variable">$PATH</span>
[root@db<span class="token number">01</span> data]# source /etc/profile

[root@db<span class="token number">01</span> data]# mysql -V
mysql  Ver <span class="token number">14.14</span> Distrib <span class="token number">5.7.28</span>, for linux-glibc<span class="token number">2.12</span> <span class="token punctuation">(</span>x<span class="token number">86</span>_<span class="token number">64</span><span class="token punctuation">)</span> using  EditLine wrapper
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-初始化数据"><a href="#5-初始化数据" class="headerlink" title="5.初始化数据"></a>5.初始化数据</h3><pre class="line-numbers language-scss"><code class="language-scss">mysqld --initialize-insecure --user=mysql --basedir=/data/app/mysql --datadir=/data/<span class="token number">3306</span>/data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="6-启动数据库-2"><a href="#6-启动数据库-2" class="headerlink" title="6.启动数据库"></a>6.启动数据库</h3><pre class="line-numbers language-scss"><code class="language-scss">[root@db<span class="token number">01</span> data]# /etc/init<span class="token number">.</span>d/mysqld start
Starting MySQL<span class="token number">.</span>Logging to <span class="token string">'/data/3306/data/db01.err'</span><span class="token number">.</span>
 SUCCESS! 

mysql> grant all on *<span class="token number">.</span>* to root@<span class="token string">'10.0.1.%'</span> identified by <span class="token string">'123'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-预-检查"><a href="#7-预-检查" class="headerlink" title="7. 预 检查"></a>7. 预 检查</h3><p>检查</p>
<pre class="line-numbers language-shell"><code class="language-shell">mysqlsh root:123@10.0.0.51:3306 -e "util.checkForServerUpgrade()"
[root@db01 ~] # mysqlsh root:123@10.0.1.51:3308 -e "util.checkForServerUpgrade()"
-----------
[root@db01 ~] # mysqlsh root:123@10.0.1.51:3308 -e "util.checkForServerUpgrade()"
WARNING: Using a password on the command line interface can be insecure.
The MySQL server at 10.0.1.51:3308, version 5.7.28 - MySQL Community Server
(GPL), will now be checked for compatibility issues for upgrade to MySQL
8.0.18...

1) Usage of old temporal type
  No issues found

2) Usage of db objects with names conflicting with new reserved keywords
  No issues found

3) Usage of utf8mb3 charset
  No issues found
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《MySQL升级和降级》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2020/02/24/di-si-zhang-mysql-sheng-ji-he-jiang-ji/" property="cc:attributionName"
               rel="cc:attributionURL">
                小明
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'godweiyang.github.io',
        owner: 'godweiyang',
        admin: "godweiyang",
        id: '2020/02/24/di-si-zhang-mysql-sheng-ji-he-jiang-ji/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/02/26/05-sql-ying-yong-ji-chu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="第五章SQL 常识">
                        
                        <span class="card-title">第五章SQL 常识</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. SQL 常识1.1 SQL的介绍属于关系型数据库产品中专用的语句。结构化查询语句。
MySQL 

1.2  SQL 标准
SQL-89  \ SQL-92  \  SQL-99   \SQL03 .....

1.3 sql_mod
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2020-02-26
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/mysql/" class="post-category" target="_blank">
                                    mysql
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/mysql/" target="_blank">
                        <span class="chip bg-color">mysql</span>
                    </a>
                    
                    <a href="/tags/leetcode/" target="_blank">
                        <span class="chip bg-color">leetcode</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/02/24/nginx-duo-ce-lue-liu-liang-fen-fa/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="Nginx多策略流量分发">
                        
                        <span class="card-title">Nginx多策略流量分发</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Nginx多策略流量分发1、场景描述在实际生产环境中，流量分发有很多情况，下面主要讲讲以下两种流量分发场景：

新版本上线，为了保证新版本稳定性，需要用线上的流量的引入，对新版本进行真实流量测试。如果新版本上线有问题，为降低影响范围，我们对
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-02-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/nginx/" class="post-category" target="_blank">
                                    nginx
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/nginx/" target="_blank">
                        <span class="chip bg-color">nginx</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('5')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 小明同学<br />'
            + '作者: 小明<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2019-2020 小明. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">22.2k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/xiaoming" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:ye33445200@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/xiaoming" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=970740860&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="https://weibo.com/xiaoming" class="tooltipped" target="_blank" data-tooltip="关注我的微博" data-position="top" data-delay="50">
        <i class="fa fa-weibo"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2019, 04, 22, 00, 00, 00); //北京时间2020-04-22 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>

</html>